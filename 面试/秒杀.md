![image-20210812220414505]()

优雅的代码：

易扩展、易修改 

![image-20210812215553531](https://tva1.sinaimg.cn/large/008i3skNly1gteclkc3csj312f0u0adp.jpg)

![image-20210812215730714](https://tva1.sinaimg.cn/large/008i3skNly1gtecn2iduhj610g0u0dj902.jpg)

![image-20210812220541073](https://tva1.sinaimg.cn/large/008i3skNly1gtecvl7qg9j614l0u0whd02.jpg)

![image-20210812215909498](https://tva1.sinaimg.cn/large/008i3skNly1gtecorzyfgj61240u0tbp02.jpg)

![image-20210812220042605](https://tva1.sinaimg.cn/large/008i3skNly1gtecqe44u4j616i0u0adb02.jpg)

![image-20210812220127586](https://tva1.sinaimg.cn/large/008i3skNly1gtecr6g84cj61ab0u0jul02.jpg)

![image-20210812220203887](https://tva1.sinaimg.cn/large/008i3skNly1gtecrt67qwj61dw0r60v402.jpg)

![image-20210812220311661](https://tva1.sinaimg.cn/large/008i3skNly1gtecsyc5xrj61770u0go202.jpg)

## 测试数据库事务

![image-20210813001508403](https://tva1.sinaimg.cn/large/008i3skNly1gtegm9imcmj30zw0ie75m.jpg)

redis安装：linux 一般安装在这个目录 

用4个cpu编译

![image-20210813001820305](https://tva1.sinaimg.cn/large/008i3skNly1gtegpk4s2nj60wq034mxf02.jpg)

![image-20210813002156715](/Users/hao/Library/Application Support/typora-user-images/image-20210813002156715.png)

用到的redis配置

![image-20210813002823538](https://tva1.sinaimg.cn/large/008i3skNly1gteh04tifdj61ae04ijro02.jpg)

![image-20210813002835059](https://tva1.sinaimg.cn/large/008i3skNly1gteh0av173j60py02w3yg02.jpg)

![image-20210813004121107](https://tva1.sinaimg.cn/large/008i3skNly1gtehdjuldsj318q0pijvz.jpg)

![image-20210813004208091](/Users/hao/Library/Application Support/typora-user-images/image-20210813004208091.png)

![image-20210813004258941](https://tva1.sinaimg.cn/large/008i3skNly1gtehfdi9ooj617803ugm402.jpg)

![image-20210813004509655](https://tva1.sinaimg.cn/large/008i3skNly1gtehhhvc0ej31fi0nun0g.jpg)

![image-20210813004912992](https://tva1.sinaimg.cn/large/008i3skNly1gtehlpdoimj60xw09egmd02.jpg)

![image-20210813004953778](https://tva1.sinaimg.cn/large/008i3skNly1gtehmeutwwj61fg0m6dk502.jpg)

![image-20210813005211565](https://tva1.sinaimg.cn/large/008i3skNly1gtehou07hrj61qy0ae0ug02.jpg)

![image-20210813005315569](https://tva1.sinaimg.cn/large/008i3skNly1gtehpwwoknj619e0b0dht02.jpg)

chkconfig命令主要用来更新（启动或停止）和查询系统服务的运行级信息

```
0代表的是关机状态，6代表的是重启状态，1代表的是单用户模式，2是没有网络功能的多用户模式，3是有网络功能的多用户模式，4还没有定义，5是桌面模式，123都是用的命令行
```

这里systemctl在旧版centos（6及以下）可能是service：服务管理

| 是管道，这个你应该懂了吧，不用多说。

一般来说， 如果要在一个具体存在的文件中查找， 那么用 grep, 比如
grep "main" test.c
用来搜索 test.c里是否包含字串 main

如果要在搜索一个命令的输出中是否包含某个字符串，那么用 | grep, 比如
ls | grep "main"
用来搜索 ls 命令执行后的输出中，是否包含 main

同理，想要分页查看一个具体的文件， 就用
more FILE
如果要分页查看一个命令执行后的输出内容，就用
somecommand | more



“|”是管道命令操作符，简称管道符。利用Linux所提供的管道符“|”将两个命令隔开，管道符左边命令的输出就会作为管道符右边命令的输入。连续使用管道意味着第一个命令的输出会作为 第二个命令的输入，第二个命令的输出又会作为第三个命令的输入，依此类推

![image-20210813012753970](/Users/hao/Library/Application Support/typora-user-images/image-20210813012753970.png)

*init.d* 目录中存放的是一系列系统服务的管理(启动与停止)脚本 



springboot 读取配置文件 @value

![image-20210813182240247](https://tva1.sinaimg.cn/large/008i3skNly1gtfc1zmnizj60p00h00ud02.jpg)

starter jar包 压缩本来的jar包到pom文件，并添加了自动配置类，默认配置，符合springoot的约定优于配置的概念

这是 maven 最核心的设计理念，很多语言框架都将其思想发扬光大。遵循约定虽然损失了一定的灵活性，不能随意安排目录结构，不能随意进行函数命名，但是却能减少配置。更重要的是，遵循约定可以帮助开发人员遵守构建标准。

模板模式

![image-20210815223123450](/Users/hao/Library/Application Support/typora-user-images/image-20210815223123450.png)

# 父类无无参构造，子类也没有参构造？

jedis.setnx(k,v):存在就插入

jedis.setex(k,e,v):设置过期时间--》jedis.set+jedis.expire

jedis.incr()和jedis.decr()是原子操作（不可分的操作，不会有中间状态）

![image-20210815225959451](https://tva1.sinaimg.cn/large/008i3skNly1gthvb2erwij61dq0qcgnq02.jpg)

![image-20210815230043159](https://tva1.sinaimg.cn/large/008i3skNly1gthvbw1lppj61nc0rw77h02.jpg)

![image-20210815230153794](https://tva1.sinaimg.cn/large/008i3skNly1gthvda05lhj616y0q4wie02.jpg)

# salt：盐  是什么

![image-20210815230359273](https://tva1.sinaimg.cn/large/008i3skNly1gthvf8uahuj61i40r4ac102.jpg)

用户端md5：防止明文密码在网络中传输

服务端MD5：防止数据库数据泄露风险

![image-20210816161656465](/Users/hao/Library/Application Support/typora-user-images/image-20210816161656465.png)

![image-20210816162921913](https://tva1.sinaimg.cn/large/008i3skNly1gtipn3jye3j61dw0ca40802.jpg)

自己的service引入自己的dao，要用到其他表的dao时引用其他的service

![image-20210816213734253](https://tva1.sinaimg.cn/large/008i3skNly1gtiyjmw82lj61ao0n0q5r02.jpg)

并发在多少的时候，网站的qt（p)s是多少

tps是多少

![image-20210816221141418](https://tva1.sinaimg.cn/large/008i3skNly1gtizj3f3waj61hw0q4tal02.jpg)

![image-20210816231426356](https://tva1.sinaimg.cn/large/008i3skNly1gtj1cbk8y8j61k60mydhj02.jpg)

![image-20210816232942405](https://tva1.sinaimg.cn/large/008i3skNly1gtj1sn8v1tj61to0u042q02.jpg)

![image-20210816233003813](https://tva1.sinaimg.cn/large/008i3skNly1gtj1smrg35j31860gg75u.jpg)

![image-20210817153233936](https://tva1.sinaimg.cn/large/008i3skNly1gtjtmbrnwzj61ko0owmyz02.jpg)

![image-20210817153303107](https://tva1.sinaimg.cn/large/008i3skNly1gtjtml4j9jj61ri0t80vh02.jpg)

provide编译时依赖，运行时不打入此jar包，因为我们运行时有tomcat

![image-20210817154347354](https://tva1.sinaimg.cn/large/008i3skNly1gtjtxtiqajj61ly0ro76a02.jpg)

![image-20210817160919113](https://tva1.sinaimg.cn/large/008i3skNly1gtjuoa8avaj61am0g40ud02.jpg)

![image-20210817160935821](https://tva1.sinaimg.cn/large/008i3skNly1gtjuomojr7j61500gsmz702.jpg)![image-20210817160836284]()

![image-20210817154941063](https://tva1.sinaimg.cn/large/008i3skNly1gtju3ztgwyj61q20kowj902.jpg)

![image-20210817155047691](https://tva1.sinaimg.cn/large/008i3skNly1gtju53rxwzj60vy0bot9u02.jpg)

# 优化

![image-20210817222657569](/Users/hao/Library/Application Support/typora-user-images/image-20210817222657569.png)

![image-20210817223215938](https://tva1.sinaimg.cn/large/008i3skNly1gtk5qw2q6ij61as0r43zq02.jpg)

![image-20210818142721056](https://tva1.sinaimg.cn/large/008i3skNly1gtkxcjkostj61lg07i0tr02.jpg)

解决卖超问题：1. sql语句加库存判断  2. 表在购买人id处加唯一索引

![image-20210818153023716](https://tva1.sinaimg.cn/large/008i3skNly1gtkz64bgi7j61lc0u042j02.jpg)

![image-20210818153059708](https://tva1.sinaimg.cn/large/008i3skNly1gtkz6qs39zj61ho0tigpm02.jpg)

第二个webpack也能实现

cdn:也相当于一种缓存

![image-20210818153145322](https://tva1.sinaimg.cn/large/008i3skNly1gtkz7igg1kj61de0igad202.jpg)

![image-20210818153437773](https://tva1.sinaimg.cn/large/008i3skNly1gtkzaiiymlj61gu0s20ul02.jpg)

并发瓶颈在数据库，最有效的方法是加缓存

1.页面静态化：页面缓存

2.cdn缓存

3.nginx缓存

4.应用程序缓存：页面缓存、对象缓存 

最后一层到数据库 

缓存的问题：数据不一致 

![image-20210818160645890](https://tva1.sinaimg.cn/large/008i3skNly1gtl07y4wyzj61ok0redi502.jpg)

![image-20210818160720530](https://tva1.sinaimg.cn/large/008i3skNly1gtl08jcvrvj61go0qiwg402.jpg)

数据库分库分表   

![image-20210818160934388](https://tva1.sinaimg.cn/large/008i3skNly1gtl0av7hwkj61ti0oi0uq02.jpg)

![image-20210818161242019](https://tva1.sinaimg.cn/large/008i3skNly1gtl0e4n3ooj61ti0r8whg02.jpg)

![image-20210818161418303](https://tva1.sinaimg.cn/large/008i3skNly1gtl0fs5vsqj61qe0neabo02.jpg)

linux源码安装三步

1.config

2.make

3.make instal

![image-20210818161631740](https://tva1.sinaimg.cn/large/008i3skNly1gtl0i3nhl4j61lk0u0tbc02.jpg)

![image-20210818161647565](https://tva1.sinaimg.cn/large/008i3skNly1gtl0id9oa6j61ok0tm76l02.jpg)

![image-20210818161732843](https://tva1.sinaimg.cn/large/008i3skNly1gtl0j5yubbj61jk0rsdhf02.jpg)

![image-20210818161856491](https://tva1.sinaimg.cn/large/008i3skNly1gtl0kmm796j61800dsgn502.jpg)

![image-20210818162021174](https://tva1.sinaimg.cn/large/008i3skNly1gtl0m46zpej61bq0so77302.jpg)

![image-20210818162814584](https://tva1.sinaimg.cn/large/008i3skNly1gtl0ubf7hbj614l0u0whw02.jpg)

第一个参数：队列名称；第二个参数：是否做持久化

![image-20210818180824558](https://tva1.sinaimg.cn/large/008i3skNly1gtl3qkb0caj61ci0g83zr02.jpg)

![image-20210818215834708](https://tva1.sinaimg.cn/large/008i3skNly1gtlae4pvxuj61hg0o4jwq02.jpg)

访问不了远程mq

![image-20210818215916482](https://tva1.sinaimg.cn/large/008i3skNly1gtlaeqhb29j61aw0i43zv02.jpg)

![image-20210818220100551](https://tva1.sinaimg.cn/large/008i3skNly1gtlagqi5pgj61b80rudlt02.jpg)

交换机相当于一个路由器，消息先发到交换机，再到队列 

![image-20210818220354408](/Users/hao/Library/Application Support/typora-user-images/image-20210818220354408.png)

![image-20210818220623693](https://tva1.sinaimg.cn/large/008i3skNly1gtlam5ogtlj61by0hqq5l02.jpg)

routingkey：路由匹配的字符串

![image-20210818221453858](https://tva1.sinaimg.cn/large/008i3skNly1gtlav5xx6aj61cu0bqacc02.jpg)

top模式支持通配符，#代表一个或多个单词，*代表一个单词

![image-20210818221636034](https://tva1.sinaimg.cn/large/008i3skNly1gtlawr0qptj61d40tqwhr02.jpg)

![image-20210818221914980](https://tva1.sinaimg.cn/large/008i3skNly1gtlazk5rpej31m50u0q7k.jpg)

![image-20210818222038371](/Users/hao/Library/Application Support/typora-user-images/image-20210818222038371.png )

fanout：广播模式

![image-20210818222740850](/Users/hao/Library/Application Support/typora-user-images/image-20210818222740850.png)

header模式：msg里必须有个header，header和设置的map中的key，value进行匹配，不根据routingkey来匹配，根据header

![image-20210818231043667](https://tva1.sinaimg.cn/large/008i3skNly1gtlch32v09j61p10u0tcu02.jpg)

![image-20210818231409227](https://tva1.sinaimg.cn/large/008i3skNly1gtlckmvjrbj61gc0fiq6502.jpg)

![image-20210818231452888](https://tva1.sinaimg.cn/large/008i3skNly1gtlclez9azj61b6092q3x02.jpg)

![image-20210819164104262](https://tva1.sinaimg.cn/large/008i3skNly1gtm6u02rb5j61qw0tkgon02.jpg)



![image-20210819164142668](https://tva1.sinaimg.cn/large/008i3skNly1gtm6ulyb92j61py0qgwg602.jpg)

![image-20210819172059777](https://tva1.sinaimg.cn/large/008i3skNly1gtm7ziasm3j61ou0u0dlm02.jpg)

压测还原：测试环境

![image-20210819172446960](https://tva1.sinaimg.cn/large/008i3skNly1gtm83g34voj61q60u0gqq02.jpg)

![image-20210819173106922](https://tva1.sinaimg.cn/large/008i3skNly1gtm8a0q6yej61ie0rcq6502.jpg)

反向代理

![image-20210819173525310](https://tva1.sinaimg.cn/large/008i3skNly1gtm8eli471j60za09eq3e02.jpg)

负载均衡 ：权重：weight ，最大访问次数， 失败时间

判活机制：访问失败两次后， 就认为服务器已经挂断，就不会再请求到这台服务器

![image-20210819173554396](/Users/hao/Library/Application Support/typora-user-images/image-20210819173554396.png)

![image-20210819174321351](https://tva1.sinaimg.cn/large/008i3skNly1gtm8mr8i4bj618c05awg502.jpg)

默认：fail_timeout为10s,max_fails为1次。

https://blog.csdn.net/zwjyyy1203/article/details/87685635

![image-20210819174438840](https://tva1.sinaimg.cn/large/008i3skNly1gtm8o41adfj61yp0u00ys02.jpg)

LVS负载均衡

![image-20210820181013517](https://tva1.sinaimg.cn/large/008i3skNly1gtnf2k2h9ij60my09wgm602.jpg)

![image-20210820181144502](https://tva1.sinaimg.cn/large/008i3skNly1gtnf2m4p8bj61qq0q2myy02.jpg)

验证码：防止机器人；分流；压测后得到估计值进行限流（或某用户一分钟内限制访问多少次）

前端只是功能性校验，安全性校验在服务端

![image-20210821150916471](https://tva1.sinaimg.cn/large/008i3skNly1gtoff4csb3j61po0r60uh02.jpg)

![image-20210821151414726](https://tva1.sinaimg.cn/large/008i3skNly1gtofk7wzoqj61j00rmju702.jpg)

用验证码增强获取秒杀地址的接口的安全 

![image-20210821153729997](https://tva1.sinaimg.cn/large/008i3skNly1gtog8fzvzaj61nu0sgacz02.jpg)

scriptEngine：jdk1.6（脚本引擎：例如调用js的方法eval（”表达式“）执行字符串表达式）

![image-20210821175558250](https://tva1.sinaimg.cn/large/008i3skNly1gtok8i7ev9j61pc0lyjtx02.jpg)

threadlocal：跟当前线程绑定

作用：线程安全；传参

![image-20210821180652762](https://tva1.sinaimg.cn/large/008i3skNly1gtokjuu7b9j614k0h0gnk02.jpg)

![image-20210821183514995](https://tva1.sinaimg.cn/large/008i3skNly1gtoldcw9vej61g00smq5k02.jpg)

![image-20210821183729286](https://tva1.sinaimg.cn/large/008i3skNly1gtolfomin7j61ku0sa40v02.jpg)

![image-20210821183755278](https://tva1.sinaimg.cn/large/008i3skNly1gtolg5cmo1j61ni0u0abz02.jpg)

![image-20210821183904558](https://tva1.sinaimg.cn/large/008i3skNly1gtolhc6udbj61kg0sktap02.jpg)

![image-20210821184012783](https://tva1.sinaimg.cn/large/008i3skNly1gtoliimgwwj61li0u0di002.jpg)

![image-20210821184119931](https://tva1.sinaimg.cn/large/008i3skNly1gtoljpkk0mj61m60p076k02.jpg)

![image-20210821184254705](https://tva1.sinaimg.cn/large/008i3skNly1gtollbpsw9j61mg0ouq4i02.jpg)

![image-20210826003346201](https://tva1.sinaimg.cn/large/008i3skNly1gtti7n2x1zj61ci0cu40002.jpg)

向controller方法里参数赋值

![image-20210826003447013](https://tva1.sinaimg.cn/large/008i3skNly1gtti8p7d9aj617i0kmq7202.jpg)