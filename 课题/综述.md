

## 基于区块链的轻量级SDN应用

> 应用层与控制层之间加区块层
>
> 增加安全性（数据不可更改、易溯源）
>
> 网络按时收费的可靠依据（记录网络配置时的资源占用情况）

### SDN

SDN网络的典型架构有三层,从上往下依次是应用层、控制层和数据转发层。应用层与控制层之间通过北向接口连接,控制层与数据转发层之间通过南向接口连接。数据转发层由功能简化的SDN交换机组成,控制层由SDN控制器组成,应用层由各种业务应用组成。SDN 控制器位于SDN控制层,是SDN网络中数据转发控制的核心。SDN控制器通过北向接口与应用层进行交互,通过南向接口将控制信息下发到数据转发层,实现网络服务功能的部署。在当前SDN网络中,网络性能的好坏很大程度取决于SDN控制器性能的强弱。当前市面流行的SDN控制器包括NOX、POX、Ryu、Trema、FloodLight、OpenDayLight、ONOS。解耦后的SDN控制层采用分布式部署、逻辑集中的运行方式,通过汇总网络状态,构建全局统一的网络视图,定义细粒度的转发抽象模型,使得SDN应用能够以动态的方式、以流级别的粒度调整转发路径和网络吞吐。SDN控制层具有对SDN数据通道的完全控制。这方便了网络按需运行复杂和精确的逻辑,通过动态调整网络业务策略,实现更髙的网络资源利用率和服务质量保证。由于SDN网络容易遭受攻击,因此我们引入区块链技术以增强SDN网络的安全性。

### 区块链

区块链技术的核心优势是去中心化、通过数据加密、分布式共识和时间戳等方式,无需可信的中心节点便可以实现点对点的交易与协作。这样可以解决中心化机构普遍存在的高成本、低效率和数据存储不够安全等问题。目前,业界对区块链技术尚未形成公认的定义。狭义来讲,区块链以数据链的方式将数据区块按照时间顺序组合成特定数据结构。以密码学方式保证的不可伪造和篡改的去中心化共享账本，能够安全地存储简单的、具有时序性的、能在系统内验证的数据。而从广义上来说,区块链技术是利用加密的链式区块结构验证和存储数据,利用分布式节点的共识算法生成和同步数据、利用自动化的脚本代码，即智能合约，进行编程和操作数据的一种全新的去中心化基础架构与分布式计算范式。借助于区块链技术,本文在SDN的应用层和控制层之间添加了区块链层。来自于应用层的网络策略会先经由区块链层进行共识认证,然后分布式存储在区块链网络中,降低数据丢失的可能性。同时区块链的数据不可更改特性也进一步保证了数据的安全。我们以“交易”的方式存储网络策略。交易信息中包含交易双方的地址以及数字签名,因此可以被用来进行确定网络策略的配置者,从而作为其占用网络资源的依据。借助于数据挖掘技术,通过采集网络流量,获取流量的时间信息,实现了网络用户的身份识别,并将通过数据挖掘得到的身份信息应用到网络设备的策略配置中,实现了网络策略的个性化和灵活配置。该过程能够自动完成,不需要人为干涉。

区块链具有六大特征

去中心化：整个网络没有中心化的硬件或者管理机构,任意节点之间的权利和义务都是均等的,且任一节点的损坏或者失去都会不影响整个系统的运作。因此也可以认为区块链系统具有极好的健壮性。

去信任：参与整个系统中的每个节点之间进行数据交换是无需互相信任的,整个系统的运作规则是公开透明的,所有的数据内容也是公开的,因此在系统指定的规则范围和时间范围内,节点之间是不能也无法欺骗其它节点。

集体维护：系统中的数据块由整个系统中所有具有维护功能的节点来共同维护,而这些具有维护功能的节点是任何人都可以参与的。

可靠数据库：整个系统将通过分数据库的形式,让每个参与节点都能获得一份完整数据库的拷贝。除非能够同时控制整个系统中超过51%的节点,否则单个节点上对数据库的修改是无效的,也无法影响其他节点上的数据内容。因此参与系统中的节点越多和计算能力越强,该系统中的数据安全性越高。

开源：由于整个系统的运作规则必须是公开透明的,所以对于程序而言,整个系统必定会是开源的。

匿名性：由于节点和节点之间是无需互相信任的,因此节点和节点之间无需公开身份,在系统中的每个参与的节点都匿名的。

### 结合

区块链和SDN结合的目的之一是增强整个网络环境的安全性。从SDN的架构来看,SDN的安全问题主要集中在控制层和应用层。SDN的特点之一是集中化控制,意味着控制层是所有网络服务的中枢机构,因此控制层是否安全关系着整个网络服务的正常与否。控制层的安全问题包括网络监听、IP地址欺骗、DDoS(Distributed Denial of Service,分布式拒绝服务)攻击以及病毒、蠕虫、木马攻击等。在SDN环境中，网络服务是通过应用层中的应用实现的,应用层的安全问题包括恶意应用、应用的安全规则冲突等。

本文将区块链技术与SDN技术结合,应用层下发的网络策略将以交易的形式存储到区块链上,以追溯来自应用层的攻击行为。通过区块链验证的交易一旦被分布式存储将很难被更改。交易信息包含交易的发起方。也就是说，如果管理员试图通过配置网络策略对SDN网络发起攻击,那他作为交易的发起人将轻易地被追踪到。同时还可以记录网络配置时的资源占用情况,作为网络资源按时收费的可靠依据。

### 具体应用

SDN典型架构

该SDN架构分为三层:数据转发层、控制层和应用层。其中,应用层和控制层通过北向接口连接,控制层和数据转发层通过南向接口连接。应用层位于SDN架构的最上层,负责对该层的多种业务和不同类型的应用进行编排,下发网络策略;控制层是SDN架构的核心层,负责收集底层网络设备的状态信息、获取拓扑结构等,并给位于数据转发层的网络设备下发策略;数据转发层位于SDN架构的最下层,由诸多网络转发设备组成,负责对网络流量的处理。ONF[开放网络基金会(Open Networking Foundation) ]提出的南向接口协议——OpenFlow得到了业界广泛的认可,而北向接口目前尚未有统一的标准。

![42501D34-4D6F-4C1D-B3BE-D2D8769C35DF](https://tva1.sinaimg.cn/large/007S8ZIlly1ggt5f39qtij30gq0bj7c0.jpg)

借助于区块链技术,在SDN的应用层和控制层之间添加区块链层。来自于应用层的网络策略会先经由区块链层进行共识认证,然后分布式地存储在区块链网络中,降低数据丢失的可能性。同时区块链的数据不可更改特性也进一步保证了数据的安全。我们以“交易”的方式存储网络策略。交易信息中包含交易双方的地址以及数字签名,因此可以被用来确定网络策略的配置者,从而作为其占用网络资源的依据。当网络管理员从应用层下发策略破坏网络设备的正常工作时,我们也可以通过交易信息追溯破坏者。

![002516F8-6202-4A13-92D8-E7B3B1C3F6AD](https://tva1.sinaimg.cn/large/007S8ZIlly1ggt5dw4btij30ha0d1jzh.jpg)

基于区块链的轻量级SDN架构工作流程

在本架构中,SDN应用层的主要功能是策略配置和策略更新。策略配置的实现方式是通过应用层的程序以流表项的形式经由REST API直接下发网络策略。策略更新是通过获取网络流量中蕴含的身份信息,结合抽象的网络需求生成具体的网络策略,下发到底层网络设备。

模块介绍

(1)数据转发模块

数据转发模块由一系列支持Openflow协议的软硬件SDN交换机组成。硬件交换机处理速度较快,软件交换机具有更大的内存和更强的灵活性。软件交换机制作较为简单,我们将在下文进行叙述。在本模块中,硬件交换机选用了华三H3C-S5130交换机。该交换机只支持OpenFlow vl.3协议,因此在选择控制器时,也要选择支持该版本协议的控制器。

(2)二层转发模块

二层转发模块是控制层与数据转发层的连接点,控制层与数据转发层通过南向接口进行通信。应用层通过该模块获取底层网络设备的信息。来自应用层的网络策略也能通过该模块下发到底层网络设备。

(3)包过滤模块

本模块包含一组过滤规则,这些规则定义了对数据包的具体操作。控制器对数据包的操作分为转发、限速或丢包等。

(4)REST API模块

 REST API是SDN中常用的北向接口之一。Ryu控制器也支持REST API,可以利用该API进行诸如流表项添加删除之类的操作。在Ryu控制器中,REST API的使用方式主要有三种。可以在浏览器中直接输入URL来发送请求,但是这里的请求只支持GET请求;也可以用curl代替浏览器访问REST API,该种方式可以实现所有请求的访问,常用于Linux系统中,curl工具一般需要自行安装;还可以使用一些接口测试工具进行访问,例如Chrome浏览器中的POSTRMAN 插件,以及Apache公司的Apache Jmeter接口测试工具。

(5)策略更新模块 

该模块相当于运行在应用层的一个应用程序,并定期获取网络用户的身份信息,将这些身份信息与抽象的网络需求相结合,生成具体的网络策略,来对当前的网络策略进行更新。

(6)策略配置模块

该模块时刻检测着底层网络设备的运行状态,并执行网络策略下发任务。在该模块中,我们预设了批量配置、抽象配置和智能配置功能。批量配置允许管理人员一次性为多个网络设备配置相同的命令。抽象配置允许管理人员只填写少量的参数来完成一次复杂的策略配置。智能配置则是基于用户身份个性化配置网络策略。

(7)数据采集模块

这里的数据采集使用的工具是JPcap。JPcap是一个Java编写的类包,所以使用时需要编写程序调用该包并设置相应的采集参数包括采集点和采集时间间隔等。本模块会定时采集流经交换机的网络流量数据,并采集一个周期的流量数据作为数据挖掘的样本数据。

(8)数据清洗模块

采集后的数据会经过该模块进一步处理。由于采集结果里含有大量的冗余数据,直接进行数据挖掘会降低整个数据挖掘过程的效率,因此需要先进行数据清洗,去除其中的冗余数据。

(9)数据变换模块

经过数据清洗后的模块虽然降低了数据的冗余量,但是还不能直接用来进行数据分析。本模块将上一模块的输出结果作为输入内容,将其中的数据进行转换,以便生成更适合进行数据分析的数据,进一步提高数据分析的效率。

(10)数据分析模块

该模块用来分析数据采集模块的数据,利用相关数据挖掘算法获取网络用户的身份信息。本文中将使用聚类分析中的K-MEANS算法。

## SDN多控制器
一般情况下,一台SDN交换机接一个SDN控制器,但是,有时候需要构建多控制器集群,就会出现控制器和交换机多对一的情况。一个分布式控制器集群,在单个控制器失效的情况下,集群中另一个控制器可以接管失效控制器所连的交换机,继续通信。分布式控制器集群中,各控制器之间需要同步交换信息,并依据一定的约定来共同管理网络中的交换机,这个规则就是控制器角色分配。

在OpenFlow协议1.3版本之前的协议(1.0, 1.1, 1.2)还不支持多控制器,直到OpenFlow协议1.3版本才新增了对于多控制器的支持。1.3版本中定义了控制器的三种角色分别为: equal, slave, master, equal是控制器的默认角色,该角色的控制器对交换机有完全访间权,可接收交换机的如Packet-in、flow_removed等异步消息；slave角色的控制器对交换机只有read-only权限,不能对交换机进行配置操作,不能接收除Port-status消息以外的交换机异步消息,一台交换机可连接多个slave角色的控制器; master角色的控制器权限跟equal角色相似,都拥有对交换机的完全访问权,所以一台交换机连接多个控制器,只允许有一台master角色的控制器,不然会有冲突。每一个控制器都会通过一个OFPT_ROLE_REQUEST消息与交换机通信,待收到交换机发来的OFPT_ROLE_REPLY消息来确定它的角色。

摘要:软件定义网络技术通过将控制和转发功能分离,并使用控制器进行集中式的网络控制,实现了网络的灵活控制和管理,近年发展迅速且得到日益广泛的应用,在以大型数据中心为代表的大规模网络中通常需要部署多台分布式SDN控制器以确保网络性能及可靠性,这些控制器长时间持续运行其硬软件升级和更换需要在线完成,且需保证服务不中断.本文针对这一问题提出了一种SDN控制器的在线更换机制,实现分布式控制器的在线更换和连续服务,同时针对控制器更换后性能异构带来的负载不均衡问题给出了异构控制器间的负载均衡算法论文最后通过实验测试验证了所提出方法的有效性。

控制器的更换过程.

![E039AB05-0175-4B5A-9D52-8B0C1BA1EBAD](https://tva1.sinaimg.cn/large/007S8ZIlly1ggwejukfbtj30aq0adq5u.jpg)

假设要用一台新的控制器x更换现有的控制器x,更换过程包括以下三个步骤:

1)将新控制器x加入到网络中

管理员将新的控制器添加到被替换控制器的位置可以通过分布式数据存储获取当前网络信息(如链路和拓扑信息等),并将其自身信息(如硬件性能、运行状态等)存储到分布式存储中以供其它控制器访问.

2)在异构分布式控制器间进行负载均衡

新加入的控制器根据当前网络负载状态和自身性能计算交换机的负载,并根据计算结果调整自身和相邻控制器的管理范围.

3)交换机平滑迁移和控制器角色更换

在确保网络中的请求能被正常接收和处理前提下,将控制器所管理的交换机迁移到新控制器,并根据上一步的负载均衡计算结果,将相邻控制器的部分交换机迁移到新控制器，在此过程中控制器和交换机间按照预先设计的角色切换流程和通信协议进行协同,以确保分布式控制器系统的服务不中断.交换机迁移完成后,管理员即可删除被更换控制器X.

## 基于区块链构建智能宽带网络

 ![5C0827BC-C203-4CD5-9A8B-B59246FE2175](https://tva1.sinaimg.cn/large/007S8ZIlly1ggwb6diys5j30bu0du79b.jpg)

所提出基于区块链的带宽网络体系架构如图1所示,其包含传输层、虚拟层、控制层和区块层等4个层面。在这种开放式控制体系架构中,可编程的控制器作为开放式控制层的主体,是实现网络安全性能的核心,该控制器为上层区块链提供统一的开放接口并针对不同任务提供不同虚拟控制器,同时通过开放式的南向硬件控制接口与底层基础设施交互,根据业务需求映射虚拟化网络,以完成业务控制与管理。

传输层由宽带网络设备与光纤链路构成,该层可以完成用户信息的高带宽、低时延传输,为不同类型的业务提供网络基础设施。在传输层中的典型技术包括密集波分复用系统(DWDM)和灵活栅格光网络(Flexi-Grid)等。其中灵活栅格光网络打破传统波长路由在带宽分配与性能管理上采用“一刀切" (one-size-fits-all)模式,将网络频谱资源进一步细化分割,把WDM网络架构中符合ITU-T标准固定波长栅格被进一步细分为夏窄小的频谱单元,从而实现根据用户需求和实际业务量大小,动态有效地分配适合的频谱资源和配置相应的调制方式,提升频谱资源利用效率。

虚拟层则通过使用宽带网络虚拟化技术,将物理网络资源抽象并分割为原子化虚拟资源,然后根据用户需求重新组成相互独立的虚拟宽带网络,在共享的物理基础架构上独立运行。不同虚拟宽带网络的并存和独立成为了虚拟层的重要特征。与其他网络技术相比,宽带网络特别是光网络有独特的虚拟功能,包括光层限制,如波长或光谱的连续性、一致性以及物理损伤等。这些光层特性将影响到虚拟宽带网络的构成数量,而且会影响并存的虚拟网络之间独立性。

控制层的核心是可编程的控制器,其在整个架构中起若“承上启下”的作用。对底层网络而言,控制器扮演硬件资源虚拟化的角色,将物理传输层中的网络设备虚拟化从而形成虚拟层,并在控制器中根据资源调度策略以及业务优先级安排资源分配方式,网络运营者可以轻松地在这种架构中实现可编程的控制。而对于控制层,控制器将根据不同业务需求,虚拟出相互独立的虚拟控制器以完成对应业务的控制与资源调度,由此可以去中心化的方式降低对控制器的计算与存储压力。

区块层完成区块链的构建并维护不同区块的相互依存。根据不同业务需求,用户向控制层发送请求,控制层按照业务的优先级和安全范围确定虚拟宽带网络的范围与所需资源,并生成虚拟控制器实现去中心化控制。虚拟网络确立后,相应任务完成的数据记录在对应的区块中,随着时间的推进,具有依存关系的区块形成区块链,从而提升宽带网络的安全性。

如今的互联网技术飞速发展,尤其是“互联网+"的提出标志着互联网已经从单一的网络技术过渡到一科社会性体系。而区块链的提出,在传统的金融和互联网领域形成颠覆性的影响。区块链技术使用去中心化共识机制来维护一个完整的、分布式的、不可篡改的数据库,能够让区块链中的参与者在无需建立信任关系的前提下实现统一的数据记录系统。其本质上是从业务角度实现一个分布式的安全机制。

宽带网络的创新也是如此,在SDN的初始阶段,网络是以统一的集中式控制为基本架构,当网络规模增加、设备复杂后,网络中安全性问题逐渐突出。基于区块链的智能宽带网络正致力于从集中式转变为分布式,将共享的没有信任关系的网络节点实现安全的信息传输。在网络安全提升至国家战略层面的今天,在“寻求转型、与业务接轨”的运营商的推动下,区块链技术将引领下一代互联网技术革新。

## 基于NFV的分布式SDN控制器节能机制

摘要: SDN架构通过控制器集中管理交换机以维护网络全局视图,因此SDN控制器是影响网络性能的关键部件。SDN控制器分为集中式控制器和分布式控制器,分布式控制器有效地解决了集中式控制器中存在的单点失效等问题,但控制器之间需要频繁交互以维护全局视图。随着网络规模扩大,其通信开销导致的能耗不断增加,且控制器的过量部署也会消耗大量能量。为了解决该问题,文章提出了一种基于NFV的SDN控制器节能机制,根据控制器负载大小分别选择启用虚拟控制器数量自适应调整算法,以及开启物理控制器频率缩放策略以减少网络能耗。同时,为了解决虚拟控制器负载不均问题,提出虚拟控制器负载自适应调整算法。当网络负载过低时,为最大限度地降低能耗,提出了基于节能和时延优化的控制器休眠算法。

关同斯坦福大学提出的SDN面向于校园网,日前在万联网和网络核心层面被广泛研究。共特点是分离控制平面和底层交换机的功能,可在控制平面形成网络的全局视图[2],并支持通过南向接口对网络资源进行分配,通过北向接口对控制平面进行编积以实现可编程网络[3]。可见, SDN的核心部分为控制器,直按决定了网终的性能和SDN架构实现的效果，SDN (Software Defined Network)集中式控制器存在单点失效问题,其安全性和扩展性都面临挑战。分布式控制器右效地解决了集中式控制器单点瓶颈及可扩展性问题[],但分布式控制器之间需要不断通信以维护全局视图。
随养网络扩大,本地网络视图策略或者把合局网络视图策略实现的分布式控制平面的通信J销导致的能耗均在不断增大。为了满足最大峰值时的网络流量,需要部界大量的SDN控制器以保证网络性能。在非峰值期,大量控制器处于空闲状态。控制器开启后,无论处于空闲状态还是负载状态,均消耗同样的能源。目前，SDN可右效地管理数据中心网络,但在大规模多控制器数据中心网络中,降低能耗方面并木充分发挥其功能7]。因此, SDN控制器能耗问题右待研究。NFV (Network Function Virtualization)通过虚拟化使得虚拟网络功能按需接入资源共享池[3]。相对于传统网络基础设置, NFV架构可节省50%的能源[].目前,同内外学者在合理部界分布式控制器以最小化开销。SDN灵活休眠模型[1]、基丁能量感知对控制器进行布局以提高SDN节能可能性[12, NFV在大规模网络中减少能源[13)、 5G网终中NFV能量效率[1等方面的研究已经取得了一定的成果。目前,已有研究多专注丁SDN分布式控制器的部界问题,对于休E第法只考虑当前控制器负载,木考虑长期效能。NFV架构可以减轻能耗,为SDN控制器节能带来了新的可能性。在SDN中通过NFV思想引入虚拟层,不仅可以解决网络流量过大时控制器处理能力不足的问题,还可以有效地降低SDN控制器能耗。

本文架构主要针对教育网,采用分级管理进行逻辑集中控制,对物理设各进行集群管理。
根据网络状态需求动态虚拟化控制器,虑拟化的控制器只需要满足网络当前所需功能不必实现物理控制器所右功能。本文主要工作:1)建立控制器数学模型并设置节能优化日标; 2)提出虚拟控制器数量白适应调整第法,根据网络流量变化动态虑拟控制器; 3)提出控制器负载白适应调整算法,调整虑拟控制器负载; 4)结合物理控制器频率缩放策略以减少能耗; 5)当网络负载过小时,提出基于节能和时延优化的控制器休眠算法,在网络流量过小时可休眼部分控制器以节约能耗。

