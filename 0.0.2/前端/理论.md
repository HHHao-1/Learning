# cookie、session

> cookie和session都是用来跟踪浏览器用户身份的

## 区别

### 存储位置

- cookie保存在浏览器端，session保存在服务器端
  - cookie是服务器发给客户端的特殊信息，以文本的方式保存在客户端，每次请求时都要带上它
  - 服务器可以为每个用户浏览器创建一个session对象，即一个浏览器独占一个session对象（默认情况下）

### 使用方式

（1）cookie机制：如果不在浏览器中设置过期时间，cookie保存在内存中，生命周期随浏览器的关闭而结束，这种cookie简称会话cookie。如果在浏览器中设置了cookie的过期时间，cookie被保存在硬盘中，关闭浏览器后，cookie数据仍然存在，直到过期时间结束才消失。

（2）session机制：当服务器收到请求需要创建session对象时，首先会检查客户端请求中是否包含sessionid。如果有sessionid，服务器将根据该id返回对应session对象。如果客户端请求中没有sessionid，服务器会创建新的session对象，并把sessionid在本次响应中返回给客户端。通常使用cookie方式存储sessionid到客户端，在交互中浏览器按照规则将sessionid发送给服务器。

- 如果用户禁用cookie或不支持cookie时，则使用URL重写，将sessionid拼接到url之后
  -    通过response.encodeURL(url) 或encodeRedirectURL(url)进行实现；
    - 区别：encodeURL会对url进行格式校验、编码；而encodeRedirectURL则不对url本身进行处理，只专注于添加sessionid参数
  - 服务器是通过请求当中cookie的sessionid来找到对应的session的。

### 存储内容

cookie只能保存字符串类型；session通过类似于Hashtable的数据结构来保存，支持任何类型的对象。

### 存储的大小

cookie：单个cookie对象保存的数据不能超过4kb；session大小没有限制。

### 安全性

cookie：针对cookie所存在的攻击：Cookie欺骗，Cookie截获；session的安全性大于cookie。

原因如下：

（1）sessionID存储在cookie中，若要攻破session首先要攻破cookie；

（2）sessionID是要启动session_start才会有，所以攻破cookie也不一定能得到sessionID；

（3）第二次启动session_start后，前一次的sessionID就是失效了，session过期sessionID也失效。

（4）sessionID是加密的

### 应用场景

cookie：

（1）判断用户是否登陆过网站，以便下次登录时能够实现自动登录。

（2）保存上次登录的时间等信息。

（3）保存上次查看的页面

（4）浏览计数

![img](https://tva1.sinaimg.cn/large/008eGmZEly1gnw6nketx7j314z09yjtm.jpg)

session：

session用于保存每个用户的专用信息，变量的值保存在服务器端，通过SessionID来区分不同的用户。

（1）网上商城中的购物车

（2）保存用户登录信息

（3）将某些数据放入session中，供同一用户的不同页面使用

（4）防止用户非法登录

### 缺点

cookie：

（1）大小受限

（2）用户可以操作（禁用）cookie，使功能受限

（3）安全性较低

（4）有些状态不可能保存在客户端

（5）每次访问都要传送cookie给服务器，浪费带宽

（6）cookie数据有路径（path）的概念，可以限制cookie只属于某个路径下

session：

（1）Session占用服务器内存，对于用户在线人数较多的网站，服务器的内存压力会比较大。

（2）依赖于cookie（sessionID保存在cookie），如果禁用/不支持cookie，要使用URL重写（不安全）

（3）创建Session变量有很大的随意性，可随时调用，不需要开发者做精确地处理，所以，过度使用session变量将会导致代码不可读且不好维护。

# H5本地存储

## Web Storage

> Web Storage数据被严格控制在客户端，不需要持续的将数据返回服务器；克服了coockie的一些限制。

具体分为两种：

- **sessionStorage：**生命周期是从进入网站到浏览器窗口关闭所经过的这段时间，也就是用户浏览这个网站所花费的时间。session对象可以用来保存在这段时间内所要保存的任何数据。

- **localStorage：**将数据保存在客户端本地的硬件设备（硬盘）中，即使浏览器窗口被关闭了，该数据仍然存在，下一次打开浏览器访问网站时仍然可以继续使用。

应用场景：

- localStoragese：长期登录，适合长期保存在本地的数据。
- sessionStorage：敏感账号一次性登录。

优点：

1. 存储空间更大：cookie为4KB，而WebStorage是5MB；
2. 节省网络流量：WebStorage不会传送到服务器，存储在本地的数据可以直接获取，也不会像cookie一样每次请求都会传送到服务器，所以减少了客户端和服务器端的交互，节省了网络流量；
3. 快速显示：有的数据存储在WebStorage上，再加上浏览器本身的缓存，速度更快；
4. WebStorage提供了一些方法，数据操作比cookie方便；
   - setItem (key, value) ——  保存数据，以键值对的方式储存信息。
   - getItem (key) ——  获取数据，将键值传入，即可获取到对应的value值。
   - removeItem (key) ——  删除单个数据，根据键值移除对应的信息。
   - clear () ——  删除所有的数据
   - key (index) —— 获取某个索引的key

## 本地数据库

在HTML5中，添加了很多功能将原本必须要保存在服务器上的数据转为保存在客户端本地，从而大大提高了Web应用程序性能，减轻了服务器的负担，使用Web时代重新回到了“客户端为重、服务器端为轻”的时代。在HTML5中内置了两种本地数据库，一种为WebSQL（SQL数据库），一种为IndexedDB（NoSQL数据库）。