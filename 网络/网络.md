# 网络架构

## 协议总览

![20140924202143732](https://tva1.sinaimg.cn/large/007S8ZIlly1ggg3omzk1hg30u016itf2.gif)

## 协议定义

![img](https://tva1.sinaimg.cn/large/007S8ZIlly1ghnwx4mw5fj30f90amgng.jpg)

## 各模块说明

![img](https://tva1.sinaimg.cn/large/007S8ZIlly1ghnwxerrv2j30dq0l478t.jpg)

## TCP/IP模型

![img](https://tva1.sinaimg.cn/large/007S8ZIlly1ghnwzv8ygej30ju0880tm.jpg)

# TCP协议

## 总览

TCP(Transmission Control Protocol 传输控制协议)是一种面向连接的、可靠的， 基于IP的传输层协议。TCP在IP报文的协议号是6。TCP是一个超级麻烦的协议，而它又是互联网的基础。

TCP是面向连接的，无论哪一方向另一方发送数据之前，都必须先在双方之间建立一条连接。在TCP/IP协议中，TCP 协议提供可靠的连接服务，连接是通过三次握手进行初始化的。三次握手的目的是同步连接双方的序列号和确认号并交换 TCP窗口大小信息。如下图TCP的通信过程所示：

![img](https://tva1.sinaimg.cn/large/007S8ZIlly1ghny5pke0vj30e80h0tfo.jpg)

　　## 报文格式

![img](https://tva1.sinaimg.cn/large/007S8ZIlly1ghny3s2y2xj30hh0ab3zp.jpg)

![img](https://tva1.sinaimg.cn/large/007S8ZIlly1ghny3ohpshj30go0ak0t3.jpg)

**Source Port和Destination Port：**分别占用16位，表示源端口号和目的端口号;用于区别主机中的不同进程， 而IP地址是用来区分不同的主机的，源端口号和目的端口号配合上IP首部中的源IP地址和目的IP地址就能唯一 的确定一个TCP连接；

**Sequence Number：**用来标识从TCP发端向TCP收端发送的数据字节流，它表示在这个报文段中的的第一个数据 字节在数据流中的序号;主要用来解决网络报乱序的问题；

**Acknowledgment Number：**32位确认序列号包含发送确认的一端所期望收到的下一个序号，因此，确认序号应 当是上次已成功收到数据字节序号加1。不过，只有当标志位中的ACK标志(下面介绍)为1时该确认序列号的字 段才有效。主要用来解决不丢包的问题；

**Offset：**给出首部中32 bit字的数目，需要这个值是因为任选字段的长度是可变的。这个字段占4bit(最多能 表示15个32bit的的字，即4*15=60个字节的首部长度)，因此TCP最多有60字节的首部。然而，没有任选字段， 正常的长度是20字节；

**TCP Flags:**TCP首部中有6个标志比特，它们中的多个可同时被设置为1，主要是用于操控TCP的状态机的，依次 为URG，ACK，PSH，RST，SYN，FIN。

**URG：**此标志表示TCP包的紧急指针域(后面马上就要说到)有效，用来保证TCP连接不被中断，并且督促 中间层设备要尽快处理这些数据；

**ACK：**此标志表示应答域有效，就是说前面所说的TCP应答号将会包含在TCP数据包中;有两个取值：0和1， 为1的时候表示应答域有效，反之为0；

**PSH：**这个标志位表示Push操作。所谓Push操作就是指在数据包到达接收端以后，立即传送给应用程序， 而不是在缓冲区中排队；

**RST：**这个标志表示连接复位请求。用来复位那些产生错误的连接，也被用来拒绝错误和非法的数据包；

**SYN：**表示同步序号，用来建立连接。SYN标志位和ACK标志位搭配使用，当连接请求的时候，SYN=1， ACK=0；连接被响应的时候，SYN=1，ACK=1；这个标志的数据包经常被用来进行端口扫描。扫描者发送 一个只有SYN的数据包，如果对方主机响应了一个数据包回来 ，就表明这台主机存在这个端口;但是由于这 种扫描方式只是进行TCP三次握手的第一次握手，因此这种扫描的成功表示被扫描的机器不很安全，一台安全 的主机将会强制要求一个连接严格的进行TCP的三次握手；

**Window：**窗口大小，也就是有名的滑动窗口，用来进行流量控制。这是一个复杂的问题，这里暂不讨论。

　　## 三次握手

> **三次握手目的：确认两边都可接受并发送数据**
>
> ```css
> 1. A发送给B：确认A可以发送、B可以接收
> 2. B发送给A：确认B可以发送、A可以接收；第一步得到确认
> 3. A发送给B：第二步得到确认
> ```
>
> 
>**第一次握手：**建立连接。客户端发送连接请求报文段，将SYN位置为1，Sequence Number为x;然后，客户端进入SYN_SEND状态，等待服务器的确认。（客户的建立连接并等待确认）
>
> 
>**第二次握手：**服务器收到SYN报文段。服务器收到客户端的SYN报文段，需要对这个SYN报文段进行确认，设置Acknowledgment Number为x+1(Sequence Number+1);同时，自己自己还要发送SYN请求信息，将SYN位置为1，Sequence Number为y;服务器端将上述所有信息放到一个报文段(即SYN+ACK报文段)中，一并发送给客户端，此时服务器进入SYN_RECV状态。（服务器端发送相关报文段信息并等待连接）
>
> **第三次握手：**客户端收到服务器的SYN+ACK报文段。然后将Acknowledgment Number设置为y+1，向服务器发送ACK报文段，这个报文段发送完毕以后，客户端和服务器端都进入ESTABLISHED状态，完成TCP三次握手。（客户端接收到服务端信息并实现连接）

## 四次分手

> **三次握手目的：确认两边数据都已发送完毕并确认断开连接**
>
> < 类比挂电话过程：我说完了，挂？→我也说完了，挂吧？→好，拜拜→bye >
>
> ```css
> 1. A发送给B：A发送完毕、A可以断开吗？
> 2. B发送给A：B发送完毕、A可以断开
> 3. B发送给A：B可以断开吗？
> 4. A发送给B：B可以断开
> ```
>
> **第一次分手：**主机1(可以使客户端，也可以是服务器端)，设置Sequence Number和Acknowledgment Number，向主机2发送一个FIN报文段;此时，主机1进入FIN_WAIT_1状态;这表示主机1没有数据要发送给主机2了。（一方数据发送完成）
>
> **第二次分手：**主机2收到了主机1发送的FIN报文段，向主机1回一个ACK报文段，Acknowledgment Number为Sequence Number加1;主机1进入FIN_WAIT_2状态;主机2告诉主机1，我也没有数据要发送了，可以进行关闭连接了。（另一方数据发送完成）
>
> **第三次分手：**主机2向主机1发送FIN报文段，请求关闭连接，同时主机2进入CLOSE_WAIT状态。（请求关闭连接并等待）
>
> **第四次分手：**主机1收到主机2发送的FIN报文段，向主机2发送ACK报文段，然后主机1进入TIME_WAIT状态;主机2收到主机1的ACK报文段以后，就关闭连接;此时，主机1等待2MSL后依然没有收到回复，则证明Server端已正常关闭，那好，主机1也可以关闭连接了。（关闭连接）

# UDP协议

## 简介
　　UDP (User Datagram Protocol 用户数据报协议)，是一种无连接的，基于IP的传输层协议，提供面向事务的简单不可靠信息传送服务。UDP在IP报文的协议号是17。

## 报文格式

　　与TCP协议不同，UDP协议是非面向连接的不可靠协议，因此没有了SYN等处理两端等待或连接的报文段，相比之下，UDP的报文格式更为简单，主要由报文头（由均16位的源端口号、目的端口号、UDP长度和UDP校验和组成）和具体传输数据组成。如图所示：

![img](https://img-blog.csdn.net/20180702155720810?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2NDU4MjY4/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)

**UDP长度：**UDP报文的整个大小，最小为8个字节（16*4位）（仅为首部）。

**UDP检验和：**在进行检验和计算时，会添加一个伪首部一起进行运算。伪首部（占用12个字节）为：4个字节的源IP地址、4个字节的目的IP地址、1个字节的0、一个字节的数字17、以及占用2个字节UDP长度。这个伪首部不是报文的真正首部，只是引入为了计算校验和。相对于IP协议的只计算首部，UDP检验和会把首部和数据一起进行校验。接收端进行的校验和与UDP报文中的校验和相与，如果无差错应该全为1。如果有误，则将报文丢弃或者发给应用层、并附上差错警告。

## 应用


在选择使用协议的时候，选择UDP必须要谨慎。在网络质量令人十分不满意的环境下，UDP协议数据包丢失会比较严重。但是由于UDP的特性：它不属于连接型协议，因而具有资源消耗小，处理速度快的优点，所以通常音频、视频和普通数据在传送时使用UDP较多，因为它们即使偶尔丢失一两个数据包，也不会对接收结果产生太大影响。比如我们聊天用的QQ就是使用的UDP协议。

# 网络的发展

　　**计算机与网络的发展过程**

![img](https://tva1.sinaimg.cn/large/007S8ZIlly1ghnx9aq58rj30f906oaam.jpg)

**计算机的模式变化**
　　起初的计算机主要以“单机”形式存在，计算机之间没有通信可言，而网络的出现才真正让计算机变得与以往的工具不同，信息的共享和交流让计算机成为划时代的产物。网络按照规模可划分为：

局域网（LAN）：局域网是某一区域内由多台计算机互联成的计算机组。一般在几公里范围内。

广域网（WAN）：广域网的范围很大，几十公里到几千公里，可以是一个区域的计算机网也可能是整个国家的计算机网。

注：我们常见的WLAN是LAN的一种，称为无线局域网。在无线局域网WLAN发明之前，人们要想通过网络进行联络和通信，必须使用物理线缆-铜绞线或光纤进行物理线路连接，但这样的局域网转载和拆卸都很麻烦。随着网络的发展，人民利用射频（Radio Frequency； RF）的技术，使用电磁波进行网络架构，实现了无线局域网互联，让信息随身化。

# IP地址

**10.0.0.1/24**

既可用地址：10.0.0.1~10.0.0.255

> / 8 = 255.0.0.0
>
> / 16 = 255.255.0.0
>
> / 24 = 255.255.255.0
>
> / 32 = 255.255.255.255

# 带宽

可以用来标识信号传输的数据传输能力、标识单位时间内通过链路的数据量、标识显示器的显示能力。

在模拟信号系统又叫频宽，是指在固定的时间可传输的资料数量，亦即在传输管道中可以传递数据的能力。通常以每秒传送周期或赫兹(**Hz**)来表示。

> 在数字设备中，带宽指单位时间能通过链路的数据量。通常以[**bps**]来表示，即每秒可传输之位数。

# VLAN

VLAN（Virtual Local Area Network）的中文名为"虚拟局域网"

> 虚拟局域网（VLAN）是一组逻辑上的设备和用户，这些设备和用户并不受物理位置的限制，可以根据功能、部门及应用等因素将它们组织起来，相互之间的通信就好像它们在同一个网段中一样，由此得名虚拟局域网。

VLAN是一种比较新的技术，工作在OSI参考模型的第2层和第3层，一个VLAN就是一个广播域，VLAN之间的通信是通过第3层的路由器来完成的。与传统的局域网技术相比较，VLAN技术更加灵活，它具有以下优点： 网络设备的移动、添加和修改的管理开销减少；可以控制广播活动；可提高网络的安全性。 

在计算机网络中，一个二层网络可以被划分为多个不同的广播域，一个广播域对应了一个特定的用户组，默认情况下这些不同的广播域是相互隔离的。不同的广播域之间想要通信，需要通过一个或多个路由器。这样的一个广播域就称为VLAN。 

# 冲突域

在以太网中，如果某个[CSMA/CD]网络上的两台计算机在同时通信时会发生冲突，那么这个CSMA/CD网络就是一个冲突域（collision domain)。如果以太网中各个网段以集线器连接，因为不能避免冲突，所以它们仍然是一个冲突域。

冲突域是在同一个网络上两个设备同时进行传输则会产生冲突；在网路内部数据分组所产生与发生冲突的这样一个区域称为冲突域，所有的共享介质环境都是一个冲突域，在共享介质环境中一定类型的冲突域是正常行为。

**预防措施**

> 集线器是一个标准的共享式设备，也就是同一时刻只有一个端口下联的设备可以发送数据。正常工作时，集线器随机选出某一端口设备并让它独占全部带宽与集线器上联设备（如交换机、路由器等）进行通信。因此，集线器设备的所有端口即形成了一个冲突域。
>
> 为了有效避免冲突，局域网中使用交换机（Switch）来分割冲突域。对网络进行分割的原因是为了分离流量并创建更小的冲突域来使用户获得更高的带宽，否则同一时刻数据太多容易导致网络拥挤形成阻塞。
>
> ```css
> 交换机的工作模式是转发、学习，交换机会自动记录每个端口下面的mac地址 然后对应端口号 这样形成一个mac-端口映射表，当有帧发过来时 他读取帧的目的mac地址 然后查找表 按照端口发送过去 如果表里没有这个mac 那么他就会利用arp广播查找这个mac地址在哪个端口 然后更新表 再进行发送，这样就使得各个数据帧有着自己的准确地址 不会每个端口进行寻找匹配而加大交换机的负担
> 
> HUB发送数据是利用广播的方式 当收到一个数据帧时他会广播所有的当口来寻找目的mac 数据量少的时候设备还能承受 数据一朵 各种冲突就会发生，一个端口可能会同时收到好几个数据 所以造成速度变慢或者丢包等问题。
> 
> 简而言之就是：一个交换机端口就是一个冲突域，一个hub是一个冲突域
> ```
>
> <img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggtv38whgyj30il0bxdge.jpg" alt="fd039245d688d43f4d6ea6447e1ed21b0ff43b44" style="zoom:50%;" />              <img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggtv3b4cxnj30il0bx753.jpg" alt="dcc451da81cb39db633050e0d3160924aa183097" style="zoom:50%;" />

# CSMA/CD

CSMA/CD即载波侦听多路访问/冲突检测，是广播型信道中采用一种随机访问技术的竞争型访问方法，具有多目标地址的特点。它处于一种总线型局域网结构，其物理拓扑结构正逐步向星型发展。CSMA/CD采用分布式控制方法，所有结点之间不存在控制与被控制的关系。既：预防、解决冲突

> 载波侦听（Carrier Sense）：意思是网络上各个工作站在发送数据前，都要确认总线上有没有数据传输。若有数据传输（称总线为忙），则不发送数据；若无数据传输（称总线为空），立即发送准备好的数据。
>
> 多路访问（Multiple Access）：意思是网络上所有工作站收发数据，共同使用同一条总线，且发送数据是广播式。
>
> “冲突检测”：是指发送结点在发出信息帧的同时，还必须监听媒体，判断是否发生冲突（同一时刻，有无其他结点也在发送信息帧）。

CSMA/CD的标准为IEEE802.3或者ISO8802/3。

# 网关

## 简介1

> 通俗描述

网关(Gateway)又称网间连接器、协议转换器。网关在网络层以上实现网络互连，是最复杂的网络互连设备，仅用于两个高层协议不同的网络互连。网关既可以用于广域网互连，也可以用于局域网互连。 网关是一种充当转换重任的计算机系统或设备。使用在不同的通信协议、数据格式或语言，甚至体系结构完全不同的两种系统之间，网关是一个翻译器。与网桥只是简单地传达信息不同，网关对收到的信息要重新打包，以适应目的系统的需求。所在层--应用层。

 **网关**，大家都知道，从一个房间走到另一个房间，必然要经过一扇门。同样，从一个网络向另一个网络发送信息，也必须经过一道“关口”，这道关口就是网关。顾名思义，网关(Gateway)就是一个网络连接到另一个网络的“关口”。 

现在的网关地址，一般是指路由器IP地址，假设你的默认网段是dao192.168.1.1,哪么这个192.168.1.1一般就是你的网关地址，当然你也可以设为其它的，可以改的。而其它的IP地址，就必须在它的后面，比如192.168.1.34（从2－255任选一个，都在这个网段内有效），如果要删除路由器上的这个网关地址，那你的电脑就上不了网了。

## 简介2

> 专业描述

主机们在不在一个广播域，完全取决于**主机连接的交换机端口们在不在同一个VLAN**：

**1. 如果在同一个VLAN，即使主机们的网段不相同，也是工作在一个广播域。**

主机们的网段相同，可以ARP发现彼此的MAC，直接通信，不需要任何三层设备（网关）的介入。

主机们的网段不相同，即使在一个广播域，也不能直接通信，需要三层设备（网关）的介入。

**2. 如果不在一个VLAN，主机们不在一个广播域**

一个VLAN对应一个网段，那么主机之间的通信需要三层设备（网关）的介入。

如果很不巧，两个VLAN里的主机使用相同的网段，主机并不知道有VLAN 的存在，所以依然认为其它主机和自己在一个广播域，但是这个广播域被交换机VLAN逻辑隔离，成为两个广播域，这时无法使用三层设备使得它们通信，唯一的方法，使用一个网桥将两个VLAN二层桥接起来，它们就可以通信了。

**所谓网关，就是上文提到的三层设备，可以是路由器、或三层交换机、防火墙。**

# 交换机

> 交换机可分为网管型和非网管型两种
>
> 非网管型的交换机没有IP，可以即插即用
>
> 网管型的交换机就有IP，对网管型交换机进行配置需使用它的IP地址登入到该网管型交换机中进行设置

## 非网管交换机

**优点：**

```css
1、价格便宜，节省开支。
2、端口数量密集。
3、用户使用灵活。
```

**缺点：**

```css
1、非网管交换机功能有限，适合家用或者小型网络中。

2、不支持ARP防护。
arp攻击不是病毒因而几乎所有的杀毒软件对之都无可奈何；但它却胜似病毒-因为它轻可造成通信变慢、网络瘫痪，重会造成信息的泄密。

3、不支持mac地址的绑定

4、不支持vlan的划分
在非网管的交换机上连接的终端用户处于同一广播域中，会爆发广播风暴，不能对其进行防护和抑制。使整个网络出现拥塞、阻断、泛洪，导致整个网络瘫痪。

5、不支持基于流量的控制

6、数据传输的可靠性差，出现丢包现象严重。

7、组装单一，不能应用在大中型网络中，对网络升级、扩展存在大的局限。

8、管理不便，硬件故障率比较大。
```

## 网管交换机

**优点：**

```css
1、背板带宽大，数据转发速度更快。

2、组网灵活，应用大中型网络的接入层。

3、提供的端口灵活，根据网络的应用选择不同的接口形式如：SFP、GE、快速以太口、以太口等。

4、支持vlan的划分，用户可以针对不同的应用进行区域划分，有效的对网络进行控制和管理。进步抑制广播风暴。

5、可网管交换机的数据吞吐量（Throughput）大、包丢失率（PacketLoss）小、延迟（Latency）低。

6、可以基于源、目的、网段进行数据信息流的控制。

7、链路聚合可以让交换机和交换机以及交换机和服务器之间通过多个以太网端口绑定在一起，实现负载均衡,

8、具有ARP的防护功能，进步减少网络的ARP欺骗

9、具有MAC地址的绑定。

10、端口镜像功能可以将一个端口的流量和状态复制到交换机的另一个端口，用于监管

11、支持DHCP的功能。

12、访问控制列表它可以对IP数据包进行控制，比如限制它的流量、出入以及提供QoS等等

13、具有较好的安全性能：交换机都可以进行MAC地址的过滤、MAC地址锁定，并可以构建静态的MAC转发表。

14、能够支持IEEE802.1Q和基于端口技术的VLAN。而IEEE802.1QVLAN中涉及的GVRP（GARP，VLAN注册协议）和GMRP（GARP组播注册协议）也被广泛地支持。

15、具有SNMP功能，更能对网络实现很好的管理和控制。

16、易于扩展，灵活应用，可以通过网络管理软件进行管理，也可以通过其本身的访问控制对其进行远程访问。增加网络的安全性和可控制性。
```

**缺点：**

```
1、比非网管交换机稍贵。
2、与非网管交换机比操作复杂，需要配置。
```

## 二层与三层交换机

> 在二层网络环境中相同vlan之间可以通信，不同vlan之间不可以通信，如果想通信必须借助三层设备，所以说三层交换机必须要做的事情是路由转发。

### 二层交换机

二层交换机工作于OSI模型的第2层(数据链路层)，故而称为二层交换机。

二层交换技术发展比较成熟，二层交换机属数据链路层设备，可以识别数据包中的MAC地址信息，根据MAC地址进行转发，并将这些MAC地址与对应的端口记录在自己内部的一个地址表中。具体的工作流程如下：

（1） 当交换机从某个端口收到一个数据包，它先读取包头中的源MAC地址，这样它就知道源MAC地址的机器是连在哪个端口上的；

（2） 再去读取包头中的目的MAC地址，并在地址表中查找相应的端口；

（3） 如表中有与这目的MAC地址对应的端口，把数据包直接复制到这端口上；

（4） 如表中找不到相应的端口则把数据包广播到所有端口上，当目的机器对源机器回应时，交换机又可以学习一目的MAC地址与哪个端口对应，在下次传送数据时就不再需要对所有端口进行广播了。

不断的循环这个过程，对于全网的MAC地址信息都可以学习到，二层交换机就是这样建立和维护它自己的地址表。

> 它按照所接收到数据包的目的MAC地址来进行转发，对于网络层或者高层协议来说是透明的。它不处理网络层的IP地址，不处理高层协议的诸如TCP、UDP的端口地址，它只需要数据包的物理地址即MAC地址，数据交换是靠硬件来实现的，其速度相当快，这是二层交换的一个显著的优点。但是，它不能处理不同IP子网之间的数据交换。传统的路由器可以处理大量的跨越IP子网的数据包，但是它的转发效率比二层低，因此要想利用二层转发效率高这一优点，又要处理三层IP数据包，三层交换技术就诞生了。

### 三层交换机

> 三层交换（也称多层交换技术，或IP交换技术）是相对于传统交换概念而提出的。众所周知，传统的交换技术是在OSI网络标准模型中的第二层——数据链路层进行操作的，而三层交换技术是在网络模型中的第三层实现了数据包的高速转发。简单地说，三层交换技术就是：二层交换技术＋三层转发技术。

三层交换机就是具有部分路由器功能的交换机。

三层交换机的最重要目的是加快大型局域网内部的数据交换，所具有的路由功能也是为这目的服务的，能够做到一次路由，多次转发。对于数据包转发等规律性的过程由硬件高速实现，而像路由信息更新、路由表维护、路由计算、路由确定等功能，由软件实现。

三层交换技术的出现，解决了局域网中网段划分之后，网段中子网必须依赖路由器进行管理的局面，解决了传统路由器低速、复杂所造成的网络瓶颈问题。

### 实际应用

它所具备的路由功能也多是围绕这一目的而展开的，所以他的路由功能没有同一档次的专业路由器强，在安全、协议支持等方面还有很多欠缺，并不能完全取代路由器工作。

> 在实际应用过程中，典型的做法是：处于同一个局域网中的各个子网的互联以及局域网中VLAN间的路由，用三层交换机来代替路由器，而只有局域网与公网互联之间要实现跨地域的网络访问时，才通过专业路由器。

![03087bf40ad162d9873be76d11dfa9ec8b13cdee](https://tva1.sinaimg.cn/large/007S8ZIlly1ggtt81xi18j30ek0cg3zx.jpg)

# 二层与三层网络

> 我们这里提到的二层、三层是按照逻辑拓扑结构进行的分类，并不是ISO七层模型中的数据链路层和网络层，而是指核心层、汇聚层和接入层。
>
> 这三层都部署的就是三层网络结构，二层网络结构没有汇聚层。

## 二层网络

只有核心层和接入层的二层网络结构模式运行简便，交换机根据MAC地址表进行数据包的转发。

有则转发，无则泛洪，即将数据包广播发送到所有端口，如果目的终端收到给出回应，那么交换机就可以将该MAC地址添加到地址表中，这是交换机对MAC地址进行建立的过程。

但这样频繁的对未知的MAC目标的数据包进行广播，在大规模的网络架构中形成的网络风暴是非常庞大的，这也很大程度上限制了二层网络规模的扩大，因此二层网络的组网能力非常有限，所以一般只是用来搭建小局域网。

## 三层网络

与二层网络不同的是，三层网络结构可以组件大型的网络。

核心层是整个网络的支撑脊梁和数据传输通道，重要性不言而喻。因此在整个三层网络结构中，核心层的设备要求是最高的，必须配备高性能的数据冗余转接设备和防止负载过剩的均衡负载的设备，以降低各核心层交换机所承载的数据量。

汇聚层是连接网络的核心层和各个接入层的应用层，在两层之间承担“媒介传输”的作用。

汇聚层应该具备以下功能：实施安全功能（划分VLAN和配置ACL）、工作组整体接入功能、虚拟网络过滤功能。因此，汇聚层设备应采用三层交换机。

接入层的面向对象是终端客户，为终端客户提供接入功能。

## 比较

> 二层网络仅仅通过MAC寻址即可实现通讯 ，但仅仅是同一个冲突域内；三层网络则需要通过IP路由实现跨网段的通讯，可以跨多个冲突域。

# Hub和Switch

## 简介

Ethernet被发明出来，需要用一个黑盒子将电脑连接起来；否则电脑和谁通信，和谁网线直连，这是点对点通信了，一点也不方便，和以太网的**多路访问网络**初衷相违背。

以太网设计目标：电脑使用一个网络接口，可以同时与多台电脑通信，将电脑连接起来的黑盒子最先面世，称之为**集线器**，但我们更喜欢叫它**Hub**。

<img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggtudapcm2j30dw08ltaz.jpg" alt="u=3493566677,2276273655&amp;fm=26&amp;gp=0" style="zoom:77%;" />

这种集线器，通常有多个端口，可以接入多台电脑，这种黑盒子使电脑连接在一起成为一种可能，其内部工作原理，就是**信号放大器**。

随着以太网的流行，越来越多的办公室使用它，网络变得越来越大，信号随着网线距离的变长，信号衰减的使得通信变得越发不可靠，同样需要可以将信号中继、放大的集线器。

但这个集线器只需两个端口，一端连着一根网线，由于其**本来的目的就是延伸网线**，美其名曰：**网桥，这个更像描述其功能性的一面，“牵线搭桥”之意。**

![91ef76c6a7efce1bc836c5e9af51f3deb48f65f7](https://tva1.sinaimg.cn/large/007S8ZIlly1ggtudmhtsoj30ao04474c.jpg)

在集线器的基础上，添加MAC地址学习功能，成为了交换机（二层），这样可以避免集线器对所有帧都广播的弊病。

但这些设备依然都是桥接设备，因为帧经过它们时，帧原封不动。

## 补充

### 桥接

桥接（Bridging），是指依据[OSI]网络模型的链路层的地址，对网络数据包进行转发的过程，工作在OSI的第二层。一般的交换机，网桥就有桥接作用

