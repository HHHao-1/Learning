 # 以太坊的存储问题

**公链：**以太坊是一个分布式的公链，由很多台电脑组网而成，每台接入这个网络的电脑本地都会保存一份完整区块链（可理解为一个本地数据库，多个文件组成）。

**旷工：**这些组网的电脑中有一些节点电脑担任所谓的矿工，矿工负责将所有这个网络上的交易打包成一个小区块，然后分发到所有的节点（包括你的电脑），这些小区块就构成了区块链。

**智能合约：**可以简单的理解为一段可执行的程序片段，具体的代码由发布人使用特定的编程语言来编写（以太坊使用的是Solidity编程语言，类似JavaScript），在本地编译成功后可以发布到区块链上。而以太坊的智能合约也可以理解为一个特殊的交易（包括可执行代码的），被发送出去后会被矿工打包记录在某一个区块中，当需要调用这个智能合约的方法时只需要向这个智能合约的地址发送一笔交易即可。

> 智能合约的工作流程：构建、存储、执行
>
> 智能合约的工作原理：智能合约由区块链内的多个用户共同参与制定，可用于用户之间的任何交易行为。协议中明确了双方的权利和义务，开发人员将这些权利和义务以电子化的方式进行编程，代码中包含会触发合约自动执行的条件。一旦编码完成，这份智能合约就被上传到区块链网络上，即全网验证节点都会接收到你和A的智能合约。智能合约会定期检查是否存在相关事件和触发条件；满足条件的事件将会推送到待验证的列队中。区块链上的验证节点先对该事件进行签名验证，以确保其有效性；等大多数验证节点先对该事件达成共识后，智能合约将成功执行，并通知用户。
>
> Gas：部署到以太坊上的智能合约是要消耗以太币的。智能合约逻辑复杂度与以太坊Gas的消耗成正比，逻辑越复杂，执行智能合约所消耗的以太坊Gas就越多。

**EVM与节点：**每个节点电脑都需要安装以太坊客户端，而这个以太坊客户端自带了EVM（超轻量级虚拟机，最小编译体积40KB，最小内存占用2KB），一个以太坊智能合约的执行环境，类似JVM一样，通过交易触发智能合约后智能合约的代码就会在EVM中执行了。这种方式相当于把程序部署到了非常非常多的电脑上（只要这个电脑安装了以太坊客户端并接入了以太坊网络），随时都可以通过交易来触发这些智能合约的执行，也从而完成了分布式程序的部署和调用。当然，目前智能合约的功能还非常有限，不能完成所有的现在编程可以解决的事情（比如访问网络下载文件，这个是目前EVM不允许和不支持的）。

我这样给你举例子，

以太坊公链就好比互联网的TCP/IP协议层，在他基础上有区块链浏览器（MIST），智能合约就好比一个个web应用（网站，与网站不同的是它不需要部署到中心化服务器上，而是部署到区块链上）。其实智能合约做的事情比这个更多，智能合约赋予你的是可以在以太坊上进行应用开发的能力，可编程的智能合约根据业务的不同可以发展出各种不同的应用（想象java平台和java语言的关系）。以太坊上只要涉及到状态的变更都会消耗以太币，比如一笔交易的产生会更改账户的状态、一个智能合约的存储或更改智能合约的状态等等，消耗掉计算资源和存储资源的都需要支付费用。智能合约是一个程序片段，由很多方法和变量组成，部署智能合约到链上（相当于发送一个交易）需要消耗以太币，通过智能合约改变智能合约的内部状态也需要消耗以太币，但也有在本地读取而不改变状态的是不需要消耗以太币的。这个话题可能不是简单的评论可以回答的清除的，我尽我所能用最通俗的语言来解答你的疑惑。