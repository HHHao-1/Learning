# 创建私有链

## 创世块

### JSON文件

**手动创建：**

```json
{
  "config": {
    "chainId": 666,
    "homesteadBlock": 0,
    "eip150Block": 0,
    "eip150Hash": "0x0000000000000000000000000000000000000000000000000000000000000000",
    "eip155Block": 0,
    "eip158Block": 0,
    "byzantiumBlock": 0,
    "constantinopleBlock": 0,
    "petersburgBlock": 0,
    "istanbulBlock": 0,
    "ethash": {}
  },
  "nonce": "0x0",
  "timestamp": "0x5ddf8f3e",
  "extraData": "0x0000000000000000000000000000000000000000000000000000000000000000",
  "gasLimit": "0x47b760",
  "difficulty": "0x00002",
  "mixHash": "0x0000000000000000000000000000000000000000000000000000000000000000",
  "coinbase": "0x0000000000000000000000000000000000000000",
  "alloc": { },
  "number": "0x0",
  "gasUsed": "0x0",
  "parentHash": "0x0000000000000000000000000000000000000000000000000000000000000000"
}
```

**puppeth生成：**

> puppeth是一个自动化运维管理工具，geth中自带

```rubby
 {
  "config": {
    "chainId": 666,
    "clique": {
      "period": 15,
      "epoch": 30000
    }
  },
  "nonce": "0x0",
  "timestamp": "0x5b5ffa7a",
  "extraData": "0x00000000000000000000000000000000000000000000000000000000000000005f9fdba8de7d3ca407a2dae41525afcc4d660943b6ad12333e3f48f9926d6cd8f407978ea16920d6fa3142b2e51e84cdebda4e4976e013988c3a1c4a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
  "gasLimit": "0x47b760",
  "difficulty": "0x1",
  "mixHash": "0x0000000000000000000000000000000000000000000000000000000000000000",
  "coinbase": "0x0000000000000000000000000000000000000000",
  "alloc": {
    "7abc981bc05de59e62168acd37ceef6118a424f0": {
      "balance": "0x200000000000000000000000000000000000000000000000000000000000000"
    },
    "8a99d622d45458e973a213845726702fe30626d9": {
      "balance": "0x200000000000000000000000000000000000000000000000000000000000000"
    }
  },
  "number": "0x0",
  "gasUsed": "0x0",
  "parentHash": "0x0000000000000000000000000000000000000000000000000000000000000000"
}
```

### 文件说明

#### 1. chainID

链ID，在全球须唯一，各个链之间ID不同。ETH的ID是1， ETC的id是61。已经在用的ID有：

| `CHAIN_ID` | Chain(s)                      |
| :--------- | :---------------------------- |
| 1          | Ethereum mainnet              |
| 2          | Expanse mainnet               |
| 3          | Ropsten                       |
| 4          | Rinkeby                       |
| 30         | Rootstock mainnet             |
| 31         | Rootstock testnet             |
| 42         | Kovan                         |
| 61         | Ethereum Classic mainnet      |
| 62         | Ethereum Classic testnet      |
| 1337       | Geth private chains (default) |

#### 2. 硬分叉设置

| 参数名称       | 参数描述                                 |
| -------------- | ---------------------------------------- |
| homesteadBlock | homesteadBlock硬分叉的高度，设置为0 即可 |
| eip150Block    | EIP 150硬分叉的高度，设置为0即可。       |
| eip150Hash     | EIP 150的hash值， 设置为0即可。          |
| eip155Block    | EIP 155硬分叉的高度，设置为0即可。       |
| eip158Block    | EIP 158硬分叉的高度，设置为0即可。       |
| byzantiumBlock | Byzantium硬分叉的高度，设置为0即可。     |

#### 3. POA 挖矿参数

以太坊目前有ethash和clique两个共识引擎,其中ethash是用于正式网络的PoW(proof-of-work)共识引擎,clique是用于测试网络的PoA(proof-of-authority)共识引擎

| 参数名称   | 参数描述                                                     |
| ---------- | ------------------------------------------------------------ |
| clique     | period： 生成块的时间，15秒。   epoch： 生成DAG的大小，默认都是3万。 |
|            |                                                              |
| mixhash    | 与nonce配合用于挖矿,由上一个区块的一部分生成的hash。注意他和nonce的设置需要满足以太坊的Yellow paper,4.3.4. Block Header Validity, (44)章节所描述的条件。 |
| nonce      | nonce就是一个64位随机数,用于挖矿,注意他和mixhash的设置需要满足以太坊的Yellow paper, 4.3.4. Block HeaderValidity, (4)章节所描述的条件。 |
| difficulty | 设置当前区块的难度,如果难度过大, cpu挖矿就很难,这里设置较小难度 |
| alloc      | 用来预置账号以及账号的以太币数量,因为私有链挖矿比较容易,所以我们不需要预置有币的账号,需要的时候自己创建即可以。 |
| coinbase   | 矿工的账号,在这里不设置                                      |
| timestamp  | 设置创世块的时间戳                                           |
| parentHash | 上一个区块的hash值,因为是创世块,所以这个值是0                |
| extraData  | 附加信息,随便填,可以填你的个性信息；在POA机制下，这里写的是预分配账户 |
| gasLimit   | 该值设置对GAS的消耗总量限制,用来限制一个区块能包含的交易信息总和,因为我们是私有链,所以填最大。 |

# 名词解释

## DAG

**DAG**是有向无环图。它用于所有Ethash算数的数字货币，如ETH-以太坊，ETC-以太经典，MUSIC-乐币，ETP-元界，DBIX-迪拜币，CLO，EXP，UBQ等其它数字货币，以提供工作量证明。DAG文件在每个挖矿纪元（epoch）都会生成一个DAG，并且会不断增加。了解DAG文件的当前和未来的大小非常重要，因为它对挖矿速度会产生很大影响。DAG文件直接位于GPU显存中。如果DAG文件比GPU显存大，那么你的显卡就不能再进行挖矿。要分析未来的dag大小，您可以查看下表。

**DAG**文件每个纪元（epoch）都会改变。一个纪元（epoch）是30000个区块。DAG文件的增加速度直接取决于出块时间。但出块时间不稳定，以太坊可能会从10秒到60秒不等。因此，每个纪元（epoch）都没有固定产生时间，它是以块为单位决定的。一般来说，以太坊的DAG文件每年增加0.72倍。但这还是得看出块时间。对于出块时间较慢的其他数字货币，DAG文件增加较慢，GPU可以挖矿很长时间。

bitcoin之所以效率低是因为它的POW机制. 整个网络只有一个主链, 其上的新块只能有一个, 无法同时创建多个新块. 10分钟左右以内的所有交易记录都被记录到一个块中. Ethereum也是类似, 大概15-20秒产生一个新块。有了DAG, 就可以同一时间创建多个块。

![0F68C9A2-B75A-4C7B-870B-7844452483B5](https://tva1.sinaimg.cn/large/007S8ZIlly1ghp7pezlc8j30om0ctwhn.jpg)

对于每一个块，首先计算一个种子(seed)，该种子只和当前块的信息有关;然后根据种子生成一个32M的随机数据集（cache）

根据Cache生成一个1GB大小的数据集合DAG(有向非循环图)，它是一个完整的搜索空间，挖矿的过程就是从DAG中随机选择元素(类似于比特币挖矿中查找合适Nonce)再进行哈希运算，可以从Cache快速计算DAG指定位置的元素，进而哈希验证。要求对Cache和DAG进行周期性更新，每1000个块更新一次，并且规定DAG的大小随着时间推移线性增长，从1G开始，每年大约增长7G左右。

